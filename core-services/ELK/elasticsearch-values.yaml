replicas: 3

volumeClaimTemplate:
  accessModes: ["ReadWriteOnce"]
  storageClassName: longhorn-retain
  resources:
    requests:
      storage: 30Gi

esJavaOpts: "-Xmx2g -Xms2g"

resources:
  requests:
    cpu: "1000m"
    memory: "2Gi"
  limits:
    cpu: "2000m"
    memory: "4Gi"

protocol: https

extraEnvs:
  - name: "ES_JAVA_OPTS"
    value: "-Xmx2g -Xms2g"
  - name: "ELASTIC_PASSWORD"
    valueFrom:
      secretKeyRef:
        name: elasticsearch-master-credentials
        key: password

security:
  enabled: true
  tls:
    autoGenerated: true

# NOTE: readinessProbe must be customized via hooks
readinessProbe:
  failureThreshold: 3
  initialDelaySeconds: 10
  periodSeconds: 10
  successThreshold: 3
  timeoutSeconds: 5
  exec:
    command:
      - bash
      - -c
      - |
        set -e
        curl -k -u "elastic:${ELASTIC_PASSWORD}" --silent --fail https://localhost:9200/_cluster/health?wait_for_status=yellow&timeout=5s > /dev/null

extraContainers:
  - name: es-exporter
    image: quay.io/prometheuscommunity/elasticsearch-exporter:latest
    ports:
      - containerPort: 9114
        name: metrics
    env:
      - name: ES_URI
        value: https://localhost:9200
      - name: ES_USERNAME
        value: elastic
      - name: ES_PASSWORD
        valueFrom:
          secretKeyRef:
            name: elasticsearch-master-credentials
            key: password
service:
  type: ClusterIP
  ports:
    - name: metrics
      port: 9114
      targetPort: 9114

metrics:
  enabled: true
  serviceMonitor:
    enabled: true
    namespace: services
    interval: 30s
    scrapeTimeout: 10s
    endpoints:
     - port: metrics
       path: /metrics
       interval: 15s
       scrapeTimeout: 10s
